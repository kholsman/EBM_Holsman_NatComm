\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage[unicode=true]{hyperref}
\hypersetup{
            pdftitle={EBM Nature Communications scripts \& data},
            pdfauthor={Kirstin Holsman},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{{#1}}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{{#1}}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{{#1}}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{{#1}}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{{#1}}}
\newcommand{\ImportTok}[1]{{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{{#1}}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{{#1}}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{{#1}}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{{#1}}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{{#1}}}}
\newcommand{\BuiltInTok}[1]{{#1}}
\newcommand{\ExtensionTok}[1]{{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{{#1}}}
\newcommand{\RegionMarkerTok}[1]{{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{{#1}}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{{#1}}}}
\newcommand{\NormalTok}[1]{{#1}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\title{EBM Nature Communications scripts \& data}
\author{Kirstin Holsman}
\date{}

\begin{document}
\maketitle

\emph{Data and code are under review and subject to change. Please do
not use without permission from lead author:
\href{mailto:kirstin.holsman@noaa.gov}{\nolinkurl{kirstin.holsman@noaa.gov}}}

Kirstin Holsman\\
Alaska Fisheries Science Center\\
NOAA Fisheries, Seattle WA\\
\textbf{\href{mailto:kirstin.holsman@noaa.gov}{\nolinkurl{kirstin.holsman@noaa.gov}}}\\
\emph{Last updated: Jun 29, 2020}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{1. Overview}\label{overview}

This is an overview of the data, code, and workflow used to generate
intermediate and final data for the Holsman et al. in review Nature
Communications paper. Below are instructions for downloading the code
and intermediate and final data and for re-generating the figures and
analyses presented in the paper. Note, in all cases species 1 = walleye
pollock, species 2 = Pacific cod, and species 3 = arrowtooth flounder.

\subsection{1.1. Data and Figures}\label{data-and-figures}

Intermediate data from the ACLIM models and simulations can be found in
the \textbf{data/in} sub-folder in the form of \texttt{.Rdata} files.
Final data from the analyses of the paper can be found in the
\textbf{data/out} sub-folder (also \texttt{.Rdata} files).

Final figures and tables (including illustrator files that were used to
add fish icons) can be found in the \textbf{Figures} sub-folder. These
figures can be called direct or re-generated (see section below ).

\section{2. Getting started:}\label{getting-started}

\subsection{2.1. Download the code from the github
repository:}\label{download-the-code-from-the-github-repository}

\begin{Shaded}
\begin{Highlighting}[]
    \CommentTok{# download the code:}
    \NormalTok{main_nm       <-}\StringTok{ "EBM_Holsman_NatComm-master"}
    \NormalTok{download_path <-}\StringTok{ }\KeywordTok{path.expand}\NormalTok{(}\StringTok{"~/desktop"}\NormalTok{)}
    \NormalTok{main          <-}\StringTok{ }\KeywordTok{file.path}\NormalTok{(download_path,main_nm)}
   
    \CommentTok{# download the code:}
    \NormalTok{dest_file     <-}\StringTok{ }\KeywordTok{file.path}\NormalTok{(download_path,}\KeywordTok{paste0}\NormalTok{(main_nm,}\StringTok{".zip"}\NormalTok{))}
    \NormalTok{url           <-}\StringTok{"https://github.com/kholsman/EBM_Holsman_NatComm/archive/master.zip"}
    \KeywordTok{download.file}\NormalTok{(}\DataTypeTok{url=}\NormalTok{url, }\DataTypeTok{destfile=}\NormalTok{dest_file)}
    
    \CommentTok{# unzip the .zip file}
    \KeywordTok{setwd}\NormalTok{(download_path)}
    \KeywordTok{unzip} \NormalTok{(dest_file, }\DataTypeTok{exdir =} \StringTok{"./"}\NormalTok{,}\DataTypeTok{overwrite =} \NormalTok{T)}
    \KeywordTok{setwd}\NormalTok{(main)}
\end{Highlighting}
\end{Shaded}

\subsection{2.2. Download data from
figshare:}\label{download-data-from-figshare}

To run the analyses or create the paper figures you will now need to
download the large zipped data folder here:
\url{https://figshare.com/s/81007e2dd5edee0a5a7a} (Data
10.6084/m9.figshare.12568625) and copy - paste the contents (folders
``in'' and ``out''``) it in the directory: `{[}your local directory
path{]}/EBM\_Holsman\_NatComm/data' or simply run the following script
to download and place the data in the correct sub-folders:

\begin{Shaded}
\begin{Highlighting}[]
    \KeywordTok{cat}\NormalTok{(}\StringTok{"The download takes a few mins (large data files)...}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}

    \NormalTok{url <-}\StringTok{  "https://ndownloader.figshare.com/files/23442137?private_link=81007e2dd5edee0a5a7a"}
    \NormalTok{dest_path  <-}\StringTok{  }\KeywordTok{file.path}\NormalTok{(main,}\StringTok{"data.zip"}\NormalTok{)}
    \KeywordTok{download.file}\NormalTok{(}\DataTypeTok{url=}\NormalTok{url, }\DataTypeTok{destfile=}\NormalTok{dest_path,}\DataTypeTok{method=}\StringTok{"libcurl"}\NormalTok{)}
    
    \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Download complete...}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
    
    \KeywordTok{unzip} \NormalTok{(}\KeywordTok{file.path}\NormalTok{(main,}\StringTok{"data.zip"}\NormalTok{), }\DataTypeTok{exdir =} \StringTok{"./"}\NormalTok{,}\DataTypeTok{overwrite=}\NormalTok{T)}
    \KeywordTok{cat}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Files unzipped successfully...}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you plan to use the data within the folder for purposes beyond
rerunning the paper analyses and figures please contact
\href{mailto:kirstin.holsman@noaa.gov}{\nolinkurl{kirstin.holsman@noaa.gov}}
and provide the following citation for the data:

10.6084/m9.figshare.12568625 along with Holsman et al. 2020.

\section{3. Regenerating analyses and
figures:}\label{regenerating-analyses-and-figures}

Below are instructions for running the R scripts to recreate the
figures, tables, results, and run the risk and threshold analyses for
the paper. The scripts below require R version 3.5.3 (available at
\url{https://cran.r-project.org/bin/macosx/el-capitan/base/}).

\subsection{3.1. Set things up:}\label{set-things-up}

The first step is to run the make.R script to load the data, packages,
and setup (where various options are specified). Note that the scripts
depend on a number of packages that will be installed the first time
through running make.R if they are not already included. \emph{A list of
those packages can be found in `EBM\_Holsman\_NatComm/R/packages.R'.}

\begin{Shaded}
\begin{Highlighting}[]
    \CommentTok{# set your local path:}
    \CommentTok{# main        <-  file.path(download_path,"EBM_Holsman_NatComm/")}
    \CommentTok{# e.g., main  <-  "/Users/kholsman/GitHub_new/EBM_Holsman_NatComm/"}
    \KeywordTok{setwd}\NormalTok{(main)}
    
    \CommentTok{# load data, packages, setup, etc.}
    \KeywordTok{source}\NormalTok{(}\StringTok{"R/make.R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{3.2. Regenerate plots:}\label{regenerate-plots}

To generate the figures in the paper without overwriting them run the
`make\_plots.R' code.

\begin{Shaded}
\begin{Highlighting}[]
    \KeywordTok{cat}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n\textbackslash{}n}\StringTok{ update.figs  = "}\NormalTok{,update.figs,}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
    \KeywordTok{cat}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}n\textbackslash{}n}\StringTok{ update.outputs  = "}\NormalTok{,update.outputs,}\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}

    \CommentTok{# You can generate individual plots like this (some take a few mins and throw warnings):}
    \KeywordTok{graphics.off}\NormalTok{()}
    \KeywordTok{fig2}\NormalTok{()}
    \KeywordTok{fig3}\NormalTok{() }\CommentTok{#  slow....}
    \KeywordTok{fig4}\NormalTok{() }\CommentTok{#  slow....}
    \KeywordTok{fig5}\NormalTok{()}
    \KeywordTok{fig6}\NormalTok{()}
    \KeywordTok{figS1}\NormalTok{()}
    \KeywordTok{figS2}\NormalTok{() }\CommentTok{#  slow....}
    \KeywordTok{figS3}\NormalTok{() }\CommentTok{#  slow....}
    \KeywordTok{figS4}\NormalTok{()}
    \KeywordTok{figS5}\NormalTok{()}
    \KeywordTok{figS6}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Alternatively, by setting \texttt{update.figs} to \texttt{TRUE} the
script will overwrite the existing figures in the \texttt{Figures}
folder:

\begin{Shaded}
\begin{Highlighting}[]
    \NormalTok{update.figs  <-}\StringTok{ }\OtherTok{TRUE}  
    \KeywordTok{stop}\NormalTok{(}\StringTok{"warning! this will overwrite existing figures in the Figures folder"}\NormalTok{)}
    \KeywordTok{source}\NormalTok{(}\StringTok{"R/sub_scripts/make_plots.R"}\NormalTok{)}
    \NormalTok{update.figs  <-}\StringTok{ }\OtherTok{FALSE}   \CommentTok{# return this to it's default setting}
\end{Highlighting}
\end{Shaded}

\subsection{3.3. Regenerate analyses and final
data}\label{regenerate-analyses-and-final-data}

To re-run the paper analyses, including risk calculations and
threshold/tipping points, set \texttt{update.outputs\ =\ TRUE}(this is
set to \texttt{FALSE} by default) and run the \texttt{SUB\_EBM\_paper.R}
script:

\begin{Shaded}
\begin{Highlighting}[]
    \NormalTok{update.outputs  <-}\StringTok{ }\OtherTok{TRUE}  
    \KeywordTok{stop}\NormalTok{(}\StringTok{"warning! Setting update.outputs to TRUE will overwrite Rdata files in the data folder"}\NormalTok{)}
    \KeywordTok{source}\NormalTok{(}\StringTok{"R/sub_scripts/SUB_EBM_paper.R"}\NormalTok{)}

    \CommentTok{# once complete set to FALSE and reload new datafiles:}
    \NormalTok{update.outputs  <-}\StringTok{ }\OtherTok{FALSE}  
    \KeywordTok{source}\NormalTok{(}\StringTok{"R/make.R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

.

\section{4. Primary and Intermediate Data sources and
models}\label{primary-and-intermediate-data-sources-and-models}

Various simulation outputs were made available for use in this analysis
through the interdisciplinary
\href{\%22https://www.fisheries.noaa.gov/alaska/ecosystems/alaska-climate-integrated-modeling-project\%22}{Alaska
Climate Integrated Modeling (ACLIM) project}. An overview of the project
and simulation experiments can be found in
\href{\%22https://www.frontiersin.org/articles/10.3389/fmars.2019.00775/full\%22}{Hollowed
et al. 2020}.

\subsection{4.1. Bering10K ROMSNPZ}\label{bering10k-romsnpz}

ACLIM indices used in this analysis can be viewed interactively online
at: \url{https://kholsman.shinyapps.io/aclim}. The indices were produced
for the ACLIM project and derived from the outputs of the Bering10K
ROMSNPZ model. Downscaled hindcasts and CMIP5 projections of
oceanographic and lower trophic conditions from the Bering10K model were
developed as part of the ACLIM project. An overview of these projections
and the Bering10K ROMSNPZ model can be found in
\href{\%22https://academic.oup.com/icesjms/article/76/5/1280/5477847\%22}{Hermann
et al. 2019},
\href{\%22https://gmd.copernicus.org/articles/13/597/2020/\%22}{Kearney
et al. 2020}, and
\href{\%22https://www.frontiersin.org/articles/10.3389/fmars.2019.00775/full\%22}{Hollowed
et al. 2020}. An overview of the Bering10K ROMSNPZ model can be found
\href{\%22https://beringnpz.github.io/roms-bering-sea/intro/\%22}{here}.

Kearney K, Hermann A, Cheng W, Ortiz I, Aydin K (2020) A coupled
pelagic-benthic-sympagic biogeochemical model for the Bering Sea:
documentation and validation of the BESTNPZ model (v2019.08.23) within a
high-resolution regional ocean model. Geosci Model Dev 13:597-650.
\url{DOI:10.5194/gmd-13-597-2020}.

\subsection{4.2. CEATTLE}\label{ceattle}

CEATTLE is a climate-enhanced multispecies stock assessment model for
walleye pollock, Pacific cod, and arrowtooth flounder
(\href{\%22https://www.sciencedirect.com/science/article/pii/S0967064515002751\%22}{Holsman
et al. 2016},
\href{\%22https://archive.afsc.noaa.gov/refm/docs/2019/EBSmultispp.pdf\%22}{2019})
that has been updated annually and included as an appendix to the BSAI
walleye pollock stock assessment
(\href{\%22https://archive.afsc.noaa.gov/refm/docs/2019/GOApollock.pdf\%22}{Ianelli
et al. 2019}) since 2016 as part of the Bering Sea fishery stock
assessment process. As part of ACLIM CEATTLE was coupled to the ROMSNPZ
model and the ATTACH model (below) to generate projections of species
biomass and catch under future climate conditions in the Bering Sea.
Methods for this coupling and projection simulation can be found in
Holsman et al. submitted and Hollowed et al. 2020. The simulation
outputs, scripts, and input data files used to generate these
simulations can be found on the ACLIM-CEATTLE gitrepo and figshare
sites. Details about the CEATTLE model can be found in the
\href{\%22https://archive.fisheries.noaa.gov/afsc/REFM/Docs/2018/BSAI/2018EBSmultispp-508.pdf\%22}{2018
Multispecies assessment} and
\href{\%22https://archive.afsc.noaa.gov/refm/docs/2019/EBSmultispp.pdf\%22}{2019
Assessments}.

Three harvest simulations are included in the available simulations: 1.
Catch = ABC where multispecies assessment simulations (run in ADMB)
using climate naive reference points for BO but climate specific B40 and
projections (climate effects on growth, M2, and recruitment). 2. Catch =
ABC + sloping harvest control rule below B40, and with F = 0 when B
\textless{} B20. 3. As in 2 but where catch\textasciitilde{}f(ABC,TAC)
via the ATTACH package (below).

\subsection{4.3. ATTACH}\label{attach}

The catchfunction package (which we refer to as the ABC To TAC and
Commercial Harvest, aka ATTACH, model: R package rename forthcoming) was
created for the Alaska Climate Integrated Modeling Project (ACLIM) by
Amanda Faig (University of Washington; School of Aquatic Fisheries and
Sciences) and Alan Haynie (NOAA; NMFS). This function, in a nutshell,
takes Bering Sea (BS) acceptable biological catch (ABC) as input and
uses a series of regression estimates to predict total allowable catch
(TAC) and from that the commercial harvest in the Bering Sea, based on
ABC, TAC, and catch data from 1992 to 2017. Documentation and code for
ATTACH can be found on the
\href{\%22https://github.com/amandafaig/catchfunction\%22}{attach
github}.

\end{document}
